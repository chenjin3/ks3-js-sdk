/*! ks3jssdk 29-01-2016 */
function b64_hmac_sha1(a,b){return binb2b64(core_hmac_sha1(a,b))+"="}function core_hmac_sha1(a,b){var c=str2binb(a);c.length>16&&(c=core_sha1(c,a.length*chrsz));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=909522486^c[f],e[f]=1549556828^c[f];var g=core_sha1(d.concat(str2binb(b)),512+b.length*chrsz);return core_sha1(e.concat(g),672)}function binb2b64(a){for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="",d=0;d<4*a.length;d+=3)for(var e=(a[d>>2]>>8*(3-d%4)&255)<<16|(a[d+1>>2]>>8*(3-(d+1)%4)&255)<<8|a[d+2>>2]>>8*(3-(d+2)%4)&255,f=0;4>f;f++)c+=8*d+6*f>32*a.length?b64pad:b.charAt(e>>6*(3-f)&63);return c}function str2binb(a){for(var b=Array(),c=255,d=0;d<a.length*chrsz;d+=chrsz)b[d>>5]|=(a.charCodeAt(d/chrsz)&c)<<24-d%32;return b}function core_sha1(a,b){a[b>>5]|=128<<24-b%32,a[(b+64>>9<<4)+15]=b;for(var c=Array(80),d=1732584193,e=-271733879,f=-1732584194,g=271733878,h=-1009589776,i=0;i<a.length;i+=16){for(var j=d,k=e,l=f,m=g,n=h,o=0;80>o;o++){16>o?c[o]=a[i+o]:c[o]=rol(c[o-3]^c[o-8]^c[o-14]^c[o-16],1);var p=safe_add(safe_add(rol(d,5),sha1_ft(o,e,f,g)),safe_add(safe_add(h,c[o]),sha1_kt(o)));h=g,g=f,f=rol(e,30),e=d,d=p}d=safe_add(d,j),e=safe_add(e,k),f=safe_add(f,l),g=safe_add(g,m),h=safe_add(h,n)}return Array(d,e,f,g,h)}function safe_add(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function rol(a,b){return a<<b|a>>>32-b}function sha1_ft(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d}function sha1_kt(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function generateHeaders(a){var b="",c=[];if(a){var d="x-kss";for(var e in a)0==e.indexOf(d)&&c.push((e+":"+a[e]).toLowerCase());c.sort(),b=c.join("\n")}return b}function generateToken(a,b,c,d,e,f,g){var h=generateHeaders(f),i="/"+b+"/"+c;if(""!==h)var j=d+"\n\n"+e+"\n"+g+"\n"+h+"\n"+i;else var j=d+"\n\n"+e+"\n"+g+"\n"+i;console.log("string2Sign:"+j);var k=b64_hmac_sha1(a,j);return console.log("signature:"+k),k}function getExpires(a){return Math.round((new Date).getTime()/1e3)+a}!function(a){var b=function(a,b){this.defaultKS3Options={KSSAccessKeyId:"",policy:"",signature:"",bucket_name:"",key:"",acl:"private",uploadDomain:"",autoStart:!1,onInitCallBack:function(){},onErrorCallBack:function(){},onFilesAddedCallBack:function(){},onBeforeUploadCallBack:function(){},onStartUploadFileCallBack:function(){},onUploadProgressCallBack:function(){},onFileUploadedCallBack:function(){},onUploadCompleteCallBack:function(){}},a&&plupload.extend(this.defaultKS3Options,a);var c={};c=this.defaultKS3Options.signature&&this.defaultKS3Options.policy?{key:this.defaultKS3Options.key,acl:this.defaultKS3Options.acl,signature:this.defaultKS3Options.signature,KSSAccessKeyId:this.defaultKS3Options.KSSAccessKeyId,policy:this.defaultKS3Options.policy}:{key:this.defaultKS3Options.key,acl:this.defaultKS3Options.acl,KSSAccessKeyId:this.defaultKS3Options.KSSAccessKeyId},this.defaultPluploadOptions={runtimes:"html5,flash,silverlight,html4",url:this.defaultKS3Options.uploadDomain||"http://kssws.ks-cdn.com/destination-bucket",browse_button:"browse",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",drop_element:void 0,multipart:!0,multipart_params:c},b&&plupload.extend(this.defaultPluploadOptions,b),this.uploader=new plupload.Uploader(this.defaultPluploadOptions),this.uploader.bind("Init",this.onInit,this),this.uploader.bind("Error",this.onUploadError,this),this.uploader.init(),this.uploader.bind("FilesAdded",this.onFilesAdded,this),this.uploader.bind("BeforeUpload",this.onBeforeUpload,this),this.uploader.bind("UploadFile",this.onStartUploadFile,this),this.uploader.bind("UploadProgress",this.onUploadProgress,this),this.uploader.bind("FileUploaded",this.onFileUploaded,this)};return b.prototype.onInit=function(a,b){this.defaultKS3Options.onInitCallBack&&this.defaultKS3Options.onInitCallBack.apply(this,[a,b])},b.prototype.onUploadError=function(a,b){this.defaultKS3Options.onErrorCallBack&&this.defaultKS3Options.onErrorCallBack.apply(this,[a,b])},b.prototype.onFilesAdded=function(a,b){this.defaultKS3Options.autoStart&&this.uploader.start(),this.defaultKS3Options.onFilesAddedCallBack&&this.defaultKS3Options.onFilesAddedCallBack.apply(this,[a,b])},b.prototype.onBeforeUpload=function(a,b){this.defaultKS3Options.onBeforeUploadCallBack&&this.defaultKS3Options.onBeforeUploadCallBack.apply(this,[a,b])},b.prototype.onStartUploadFile=function(a,b){this.defaultKS3Options.onStartUploadFileCallBack&&this.defaultKS3Options.onStartUploadFileCallBack.apply(this,[a,b])},b.prototype.onUploadProgress=function(a,b){this.defaultKS3Options.onUploadProgressCallBack&&this.defaultKS3Options.onUploadProgressCallBack.apply(this,[a,b])},b.prototype.onFileUploaded=function(a,b,c){this.defaultKS3Options.onFileUploadedCallBack&&this.defaultKS3Options.onFileUploadedCallBack.apply(this,[a,b,c])},b.prototype.onUploadComplete=function(a,b){this.defaultKS3Options.onUploadCompleteCallBack&&this.defaultKS3Options.onUploadCompleteCallBack.apply(this,[a,b])},a.ks3FileUploader=b}(window);var Ks3={};Ks3.addURLParam=function(a,b){a+=-1==a.indexOf("?")?"?":"";var c=[];for(var d in b){d=encodeURIComponent(d);var e=b[d];e&&"[object String]"==Object.prototype.toString.call(e)&&c.push(d+"="+encodeURIComponent(e))}return a+c.join("&")},Ks3.xmlToJson=function(a){var b={};if(3==a.nodeType&&(b=a.nodeValue),a.hasChildNodes())for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes.item(c),e=d.nodeName;if("undefined"==typeof b[e])"#text"===e?b=d.nodeValue:b[e]=Ks3.xmlToJson(d);else{if("undefined"==typeof b[e].length){var f=b[e];b[e]=[],b[e].push(f)}b[e].push(Ks3.xmlToJson(d))}}return b},Ks3.Base64={},Ks3.Base64.encTable=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],Ks3.Base64.decTable=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],Ks3.Base64.encUTF8=function(a){for(var b,c,d,e,f,g,h,i=[],j=a.length,k=0;j>k;k++)b=a.charCodeAt(k),b>0&&127>=b?i.push(b):b>=128&&2047>=b?(c=192|b>>6&31,d=128|63&b,i.push(c,d)):b>=2048&&65535>=b?(c=224|b>>12&15,d=128|b>>6&63,e=128|63&b,i.push(c,d,e)):b>=65536&&2097151>=b?(c=240|b>>18&7,d=128|b>>12&63,e=128|b>>6&63,f=128|63&b,i.push(c,d,e,f)):b>=2097152&&67108863>=b?(c=240|b>>24&3,d=240|b>>18&63,e=128|b>>12&63,f=128|b>>6&63,g=128|63&b,i.push(c,d,e,f,g)):b>=67108864&&2147483647>=b&&(c=240|b>>30&1,d=240|b>>24&63,e=240|b>>18&63,f=128|b>>12&63,g=128|b>>6&63,h=128|63&b,i.push(c,d,e,f,g,h));return i},Ks3.Base64.encode=function(a){if(!a)return"";for(var b,c,d,e=Ks3.Base64.encUTF8(a),f=0,g=e.length,h=[];g>f;){if(b=255&e[f++],h.push(Ks3.Base64.encTable[b>>2]),f==g){h.push(Ks3.Base64.encTable[(3&b)<<4],"==");break}if(c=e[f++],f==g){h.push(Ks3.Base64.encTable[(3&b)<<4|c>>4&15]),h.push(Ks3.Base64.encTable[(15&c)<<2],"=");break}d=e[f++],h.push(Ks3.Base64.encTable[(3&b)<<4|c>>4&15]),h.push(Ks3.Base64.encTable[(15&c)<<2|(192&d)>>6]),h.push(Ks3.Base64.encTable[63&d])}return h.join("")};const chrsz=8,b64pad="";